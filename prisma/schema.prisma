generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model ContactSubmission {
  id          String            @id @default(cuid())
  name        String
  email       String
  subject     String
  service     String
  message     String
  newsletter  Boolean           @default(false)
  submittedAt DateTime          @default(now())
  ipAddress   String?
  userAgent   String?
  status      ContactStatus     @default(PENDING)
  adminNotes  String?
  respondedAt DateTime?
  respondedBy String?
  responses   ContactResponse[]

  @@map("contact_submissions")
}

model ContactResponse {
  id           String            @id @default(cuid())
  submissionId String
  adminId      String?
  response     String
  responseType ResponseType
  sentAt       DateTime          @default(now())
  submission   ContactSubmission @relation(fields: [submissionId], references: [id], onDelete: Cascade)

  @@map("contact_responses")
}

model NewsletterSubscriber {
  id             String    @id @default(cuid())
  email          String    @unique
  name           String?
  subscribedAt   DateTime  @default(now())
  unsubscribedAt DateTime?
  isActive       Boolean   @default(true)
  source         String?
  tags           String?

  @@map("newsletter_subscribers")
}

model AdminUser {
  id           String    @id @default(cuid())
  email        String    @unique
  name         String
  role         AdminRole @default(ADMIN)
  createdAt    DateTime  @default(now())
  lastLogin    DateTime?
  passwordHash String
  isActive     Boolean   @default(true)

  @@map("admin_users")
}

model ContactAnalytics {
  id                String   @id @default(cuid())
  date              DateTime @unique @default(now())
  submissions       Int      @default(0)
  newsletterSignups Int      @default(0)
  serviceBreakdown  Json?

  @@map("contact_analytics")
}

/// *
///  * Hero Slides - Dynamic content for homepage hero section
///  * Allows admin to manage carousel slides with custom content
model HeroSlide {
  id             String   @id @default(cuid())
  titleLine1     String
  titleLine2     String
  tagline        String
  description    String
  imageUrl       String
  gradient       String
  buttonGradient String
  buttonBorder   String
  buttonText     String
  buttonHover    String
  isActive       Boolean  @default(true)
  sortOrder      Int      @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  createdBy      String?
  altText        String?
  projectTitle   String?
  projectDesc    String?

  @@map("hero_slides")
}

/// *
///  * Hero Slideshow Configuration - Global settings for hero carousel behavior
///  * Controls auto-play, transitions, indicators, and timing
model HeroSlideshowConfig {
  id                 String   @id @default(cuid())
  autoPlayEnabled    Boolean  @default(true)
  autoPlayInterval   Int      @default(7000)
  showIndicators     Boolean  @default(true)
  transitionEffect   String   @default("fade")
  transitionDuration Int      @default(700)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  createdBy          String?

  @@map("hero_slideshow_config")
}

model User {
  id                String             @id @default(cuid())
  email             String             @unique
  name              String?
  picture           String?
  workosId          String?            @unique
  tier              UserTier           @default(GUEST)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  storageQuota      Int                @default(1073741824)
  storageUsed       Int                @default(0)
  fileShares        FileShare[]        @relation("SharedByUser")
  receivedShares    FileShare[]        @relation("SharedWithUser")
  files             File[]
  folders           Folder[]
  googleDriveConfig GoogleDriveConfig?

  @@map("users")
}

model File {
  id              String        @id @default(cuid())
  name            String
  originalName    String
  mimeType        String
  size            Int
  path            String
  folderId        String?
  ownerId         String
  storageProvider String        @default("local")
  storagePath     String?
  checksum        String?
  metadata        Json?
  isPublic        Boolean       @default(false)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  shares          FileShare[]
  versions        FileVersion[]
  folder          Folder?       @relation(fields: [folderId], references: [id])
  owner           User          @relation(fields: [ownerId], references: [id])

  @@map("files")
}

model Folder {
  id        String   @id @default(cuid())
  name      String
  path      String
  parentId  String?
  ownerId   String
  color     String?
  icon      String?
  isShared  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  files     File[]
  owner     User     @relation(fields: [ownerId], references: [id])
  parent    Folder?  @relation("FolderHierarchy", fields: [parentId], references: [id])
  children  Folder[] @relation("FolderHierarchy")

  @@map("folders")
}

model FileShare {
  id           String          @id @default(cuid())
  fileId       String
  sharedById   String
  sharedWithId String?
  shareType    ShareType       @default(USER)
  permissions  PermissionLevel @default(READ)
  expiresAt    DateTime?
  createdAt    DateTime        @default(now())
  file         File            @relation(fields: [fileId], references: [id])
  sharedBy     User            @relation("SharedByUser", fields: [sharedById], references: [id])
  sharedWith   User?           @relation("SharedWithUser", fields: [sharedWithId], references: [id])

  @@map("file_shares")
}

model FileVersion {
  id          String   @id @default(cuid())
  fileId      String
  version     Int
  size        Int
  checksum    String
  storagePath String
  createdAt   DateTime @default(now())
  file        File     @relation(fields: [fileId], references: [id])

  @@map("file_versions")
}

model StorageAnalytics {
  id            String   @id @default(cuid())
  userId        String?
  date          DateTime @default(now())
  uploads       Int      @default(0)
  downloads     Int      @default(0)
  storageUsed   Int      @default(0)
  bandwidthUsed Int      @default(0)
  fileTypes     Json?

  @@unique([userId, date])
  @@map("storage_analytics")
}

model GoogleDriveConfig {
  id                 String             @id @default(cuid())
  userId             String             @unique
  accessToken        String
  refreshToken       String
  tokenExpiry        DateTime
  enabled            Boolean            @default(false)
  syncDirection      SyncDirection      @default(BIDIRECTIONAL)
  conflictResolution ConflictResolution @default(LOCAL_WINS)
  syncInterval       Int                @default(60)
  folderMappings     Json?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  lastSync           DateTime?
  user               User               @relation(fields: [userId], references: [id])

  @@map("google_drive_configs")
}

model DiagnosticHistory {
  id        String           @id @default(cuid())
  type      DiagnosticType
  status    DiagnosticStatus
  timestamp DateTime         @default(now())
  duration  Int?
  title     String
  summary   String
  results   Json
  warnings  Int              @default(0)
  errors    Int              @default(0)

  @@map("diagnostic_history")
}

model DiagnosticConfig {
  id             String    @id @default(cuid())
  autoEnabled    Boolean   @default(true)
  autoInterval   Int       @default(3600000)
  lastRun        DateTime?
  runFullSystem  Boolean   @default(true)
  runAIBenchmark Boolean   @default(true)
  runStorageScan Boolean   @default(true)
  runNetworkTest Boolean   @default(false)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@map("diagnostic_config")
}

model DiagnosticSchedule {
  id          String         @id @default(cuid())
  type        DiagnosticType
  scheduledAt DateTime
  isRecurring Boolean        @default(false)
  interval    Int?
  status      ScheduleStatus @default(PENDING)
  executedAt  DateTime?
  resultId    String?
  createdAt   DateTime       @default(now())
  createdBy   String?

  @@map("diagnostic_schedule")
}

enum ContactStatus {
  PENDING
  PROCESSED
  RESPONDED
  ARCHIVED
}

enum ResponseType {
  EMAIL
  CALL
  MEETING
  NOTE
}

enum AdminRole {
  SUPER_ADMIN
  ADMIN
  MODERATOR
}

enum UserTier {
  ADMIN
  TIER3
  TIER2
  TIER1
  GUEST
}

enum ShareType {
  USER
  PUBLIC
  TEAM
}

enum PermissionLevel {
  READ
  WRITE
  ADMIN
}

enum SyncDirection {
  UPLOAD
  DOWNLOAD
  BIDIRECTIONAL
}

enum ConflictResolution {
  LOCAL_WINS
  REMOTE_WINS
  MANUAL
}

enum DiagnosticType {
  FULL_SYSTEM
  AI_BENCHMARK
  HARDWARE_BENCHMARK
  STORAGE_SCAN
  NETWORK_TEST
}

enum DiagnosticStatus {
  PASSED
  WARNINGS
  FAILED
}

enum ScheduleStatus {
  PENDING
  RUNNING
  COMPLETED
  FAILED
  CANCELLED
}
