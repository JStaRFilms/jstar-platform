# .github/workflows/spawn-template.yml
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# J STAR CODE REVIEW - SPAWNER TEMPLATE
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# COPY THIS FILE to any repository at: .github/workflows/jstar-review.yml
# Then add GROQ_API_KEY to your repo secrets. That's it!
#
# For custom project context (coding rules, architecture docs), create:
#   - .jstar/rules.md       (your coding guidelines)
#   - .jstar/architecture.md (your project structure overview)
#
# The bot will automatically pick these up and use them in reviews.
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

name: J Star Code Review

on:
  pull_request:
    types: [opened, synchronize, reopened]
  issue_comment:
    types: [created]

permissions:
  contents: read
  pull-requests: write
  issues: write

jobs:
  # Gate check - only run on PRs or /review comments
  check:
    name: ðŸ” Check Trigger
    runs-on: ubuntu-latest
    outputs:
      should_run: ${{ steps.check.outputs.should_run }}
    steps:
      - name: Check if should run
        id: check
        run: |
          if [[ "${{ github.event_name }}" == "pull_request" ]]; then
            echo "should_run=true" >> $GITHUB_OUTPUT
          elif [[ "${{ github.event_name }}" == "issue_comment" && \
                  "${{ contains(github.event.comment.body, '/review') }}" == "true" && \
                  "${{ github.event.issue.pull_request != null }}" == "true" ]]; then
            echo "should_run=true" >> $GITHUB_OUTPUT
          else
            echo "should_run=false" >> $GITHUB_OUTPUT
          fi

  # Call the J Star Review bot from the source repo
  review:
    name: ðŸŒŸ J Star Review
    needs: check
    if: needs.check.outputs.should_run == 'true'
    uses: JStaRFilms/jstar-code-review/.github/workflows/reusable-review.yml@main
    secrets:
      GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
    # Optionally customize models:
    # with:
    #   triage_model: 'openai/gpt-oss-120b'
    #   analyst_model: 'moonshotai/kimi-k2-instruct-0905'
